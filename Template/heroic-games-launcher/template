# Template file for 'heroic-games-launcher'
pkgname=heroic-games-launcher
version=2.20.1
revision=1
nopie=yes
archs="x86_64"
hostmakedepends="pnpm python3"
makedepends="electron35-devel"
depends="wine winetricks curl zenity gamemode"
short_desc="A games launcher for GOG, Amazon and Epic Games."
maintainer="ErenHDE <erenozturkhde@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://heroicgameslauncher.com/"
distfiles="https://github.com/Heroic-Games-Launcher/HeroicGamesLauncher/archive/refs/tags/v${version}.tar.gz"
checksum=62631a3917a65c5ff4f2ac02e12bf039b5880c103464a60f6418e16e9745e2d1

do_build() {
	export CFLAGS="${CFLAGS//-fno-PIE/}"
	export CXXFLAGS="${CXXFLAGS//-fno-PIE/}"
	export LDFLAGS="${LDFLAGS//-no-pie/}"

	pnpm install
	pnpm download-helper-binaries
	pnpm dist:linux tar.xz
}

do_install() {
	vcopy dist/linux-unpacked /usr/lib/heroic

	vmkdir usr/bin
	ln -sf /usr/lib/heroic/heroic ${DESTDIR}/usr/bin/heroic

	sed -i 's/heroic-run/heroic/' flatpak/com.heroicgameslauncher.hgl.desktop
	vinstall flatpak/com.heroicgameslauncher.hgl.desktop 644 usr/share/applications
	vinstall flatpak/com.heroicgameslauncher.hgl.png 644 usr/share/pixmaps
}
